{"version":3,"sources":["../node_modules/pdfjs-dist/build sync","component/Viewer/PDF.js"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","pdfjs","GlobalWorkerOptions","workerSrc","version","useStyles","makeStyles","theme","layout","marginTop","marginLeft","spacing","marginRight","breakpoints","up","maxWidth","canvas","width","height","borderRadius","paper","marginBottom","PDFViewer","math","useRouteMatch","location","useLocation","query","URLSearchParams","search","useParams","useState","pageNumber","setPageNumber","dispatch","useDispatch","SetSubTitle","useCallback","title","changeSubTitle","ToggleSnackbar","vertical","horizontal","msg","color","toggleSnackbar","useEffect","pathHelper","isSharePage","pathname","get","path","split","length","params","removeTextLayerOffset","document","querySelectorAll","forEach","layer","style","display","classes","className","onLoadSuccess","numPages","onLoadError","error","message","loading","elevation","file","getBaseURL","encodeURIComponent","Array","from","el","index","key","renderAnnotationLayer"],"mappings":"kHAAA,SAASA,EAAoBC,GAC5B,IAAIC,EAAI,IAAIC,MAAM,uBAAyBF,EAAM,KAEjD,MADAC,EAAEE,KAAO,mBACHF,EAEPF,EAAoBK,KAAO,WAAa,MAAO,IAC/CL,EAAoBM,QAAUN,EAC9BO,EAAOC,QAAUR,EACjBA,EAAoBS,GAAK,M,8SCGzBC,QAAMC,oBAAoBC,UAA1B,kDAAiFF,QAAMG,QAAvF,kBAEA,IAAMC,EAAYC,aAAW,SAAAC,GAAK,YAAK,CACnCC,QAAM,GACFC,UAAW,OACXC,WAAYH,EAAMI,QAAQ,GAC1BC,YAAaL,EAAMI,QAAQ,IAHzB,cAIDJ,EAAMM,YAAYC,GAAG,KAA0B,EAAnBP,EAAMI,QAAQ,IAAU,CACjDI,SAAU,IACVL,WAAY,OACZE,YAAa,SAPf,6BASY,IATZ,GAWN,UAAW,CACPI,OAAQ,CACJC,MAAO,kBACPC,OAAQ,kBACRC,aAAc,IAGtBC,MAAO,CACHC,aAAcd,EAAMI,QAAQ,QAQrB,SAASW,IACpB,IAAMC,EAAOC,cACPC,EAAWC,cACXC,EANC,IAAIC,gBAAgBF,cAAcG,QAOjC7B,EAAO8B,cAAP9B,GAJwB,EAMI+B,mBAAS,GANb,mBAMzBC,EANyB,KAMbC,EANa,KAQ1BC,EAAWC,cACXC,EAAcC,uBAAY,SAAAC,GAAK,OAAIJ,EAASK,YAAeD,MAAS,CACtEJ,IAEEM,EAAiBH,uBACnB,SAACI,EAAUC,EAAYC,EAAKC,GAA5B,OACIV,EAASW,YAAeJ,EAAUC,EAAYC,EAAKC,MACvD,CAACV,IAGLY,qBAAU,WACN,GAAKC,IAAWC,YAAYvB,EAASwB,UAIjCb,EAAYT,EAAMuB,IAAI,aAJsB,CAC5C,IAAMC,EAAOxB,EAAMuB,IAAI,KAAKE,MAAM,KAClChB,EAAYe,EAAKA,EAAKE,OAAS,OAKpC,CAAC9B,EAAK+B,OAAO,GAAI7B,IAEpB,IAAM8B,EAAwB,WACPC,SAASC,iBACxB,iCAEOC,SAAQ,SAAAC,GACGA,EAAVC,MACFC,QAAU,WAIlBC,EAAUzD,IAChB,OACI,yBAAK0D,UAAWD,EAAQtD,QACpB,kBAAC,WAAD,CACIwD,cAAe,gBAAGC,EAAH,EAAGA,SAAH,OAAkBhC,EAAcgC,IAC/CC,YAAa,SAAAC,GACT3B,EACI,MACA,QACA,qCAAc2B,EAAMC,QACpB,UAGRC,QACI,kBAAC,IAAD,CAAON,UAAWD,EAAQ1C,MAAOkD,UAAW,GACxC,kBAAC,IAAD,OAGRC,KACIC,eACCzB,IAAWC,YAAYvB,EAASwB,UAC3B,kBACAjD,GAC6B,KAA5B2B,EAAMuB,IAAI,cACL,SACAuB,mBAAmB9C,EAAMuB,IAAI,eAC7B,IACN,iBAAmBvB,EAAMuB,IAAI,QAGtCwB,MAAMC,KAAK,IAAID,MAAM1C,IAAa,SAAC4C,EAAIC,GAAL,OAC/B,kBAAC,IAAD,CAAOd,UAAWD,EAAQ1C,MAAOkD,UAAW,GACxC,kBAAC,OAAD,CACIrD,MAAO,IACP+C,cAAeT,EACfuB,IAAG,eAAUD,EAAQ,GACrB7C,WAAY6C,EAAQ,EACpBE,uBAAuB","file":"static/js/pdf.d41c3a3a.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 5442;","import React, { useCallback, useEffect, useState } from \"react\";\nimport { Document, Page, pdfjs } from \"react-pdf\";\nimport { Paper } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { useLocation, useParams, useRouteMatch } from \"react-router\";\nimport { getBaseURL } from \"../../middleware/Api\";\nimport { useDispatch } from \"react-redux\";\nimport { toggleSnackbar } from \"../../actions\";\nimport { changeSubTitle } from \"../../redux/viewUpdate/action\";\nimport pathHelper from \"../../utils/page\";\nimport TextLoading from \"../Placeholder/TextLoading\";\npdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`;\n\nconst useStyles = makeStyles(theme => ({\n    layout: {\n        marginTop: \"30px\",\n        marginLeft: theme.spacing(3),\n        marginRight: theme.spacing(3),\n        [theme.breakpoints.up(1100 + theme.spacing(3) * 2)]: {\n            maxWidth: 900,\n            marginLeft: \"auto\",\n            marginRight: \"auto\"\n        },\n        marginBottom: 50\n    },\n    \"@global\": {\n        canvas: {\n            width: \"100% !important\",\n            height: \"auto !important\",\n            borderRadius: 4\n        }\n    },\n    paper: {\n        marginBottom: theme.spacing(3)\n    }\n}));\n\nfunction useQuery() {\n    return new URLSearchParams(useLocation().search);\n}\n\nexport default function PDFViewer() {\n    const math = useRouteMatch();\n    const location = useLocation();\n    const query = useQuery();\n    const { id } = useParams();\n\n    const [pageNumber, setPageNumber] = useState(1);\n\n    const dispatch = useDispatch();\n    const SetSubTitle = useCallback(title => dispatch(changeSubTitle(title)), [\n        dispatch\n    ]);\n    const ToggleSnackbar = useCallback(\n        (vertical, horizontal, msg, color) =>\n            dispatch(toggleSnackbar(vertical, horizontal, msg, color)),\n        [dispatch]\n    );\n\n    useEffect(() => {\n        if (!pathHelper.isSharePage(location.pathname)) {\n            const path = query.get(\"p\").split(\"/\");\n            SetSubTitle(path[path.length - 1]);\n        } else {\n            SetSubTitle(query.get(\"name\"));\n        }\n        // eslint-disable-next-line\n    }, [math.params[0], location]);\n\n    const removeTextLayerOffset = () => {\n        const textLayers = document.querySelectorAll(\n            \".react-pdf__Page__textContent\"\n        );\n        textLayers.forEach(layer => {\n            const { style } = layer;\n            style.display = \"none\";\n        });\n    };\n\n    const classes = useStyles();\n    return (\n        <div className={classes.layout}>\n            <Document\n                onLoadSuccess={({ numPages }) => setPageNumber(numPages)}\n                onLoadError={error => {\n                    ToggleSnackbar(\n                        \"top\",\n                        \"right\",\n                        \"PDF 加载失败，\" + error.message,\n                        \"error\"\n                    );\n                }}\n                loading={\n                    <Paper className={classes.paper} elevation={1}>\n                        <TextLoading />\n                    </Paper>\n                }\n                file={\n                    getBaseURL() +\n                    (pathHelper.isSharePage(location.pathname)\n                        ? \"/share/preview/\" +\n                          id +\n                          (query.get(\"share_path\") !== \"\"\n                              ? \"?path=\" +\n                                encodeURIComponent(query.get(\"share_path\"))\n                              : \"\")\n                        : \"/file/preview/\" + query.get(\"id\"))\n                }\n            >\n                {Array.from(new Array(pageNumber), (el, index) => (\n                    <Paper className={classes.paper} elevation={1}>\n                        <Page\n                            width={900}\n                            onLoadSuccess={removeTextLayerOffset}\n                            key={`page_${index + 1}`}\n                            pageNumber={index + 1}\n                            renderAnnotationLayer={false}\n                        />\n                    </Paper>\n                ))}\n            </Document>\n        </div>\n    );\n}\n"],"sourceRoot":""}